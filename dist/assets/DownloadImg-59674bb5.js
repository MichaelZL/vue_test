import{h as m,l as v,m as w,A as k,n as u,f as x,z as y,_ as C,g as l,o as r,c as g,a,i as h,F as b,j as F,w as D,q as L,B,x as E,p as S,k as T}from"./index-c33601ed.js";import{s as d}from"./conversion-aeb0719e.js";const P={data(e){return{host:m,images:["https://dummyimage.com/220x320/c2c2c2/fff.png","https://dummyimage.com/220x320/c2c2c2/fff.png","https://dummyimage.com/220x320/c2c2c2/fff.png","https://dummyimage.com/220x320/c2c2c2/fff.png"],selectIndex:-1,imgStyle:"img",orderId:"",downloadedImage:0,selectImgPath:""}},methods:{onClickLeft(){this.$router.back()},onImgTap(e){let t=this.images[e];this.selectIndex=e;var s=m+t;this.selectImgPath=t,v({images:[s],closeable:!0,showIndex:!1,minZoom:1,closeIcon:"cross",closeIconPosition:"top-left",closeOnClickOverlay:!1})},checkStyle(e){return this.selectIndex==e?"selectimg":"img"},onDloadImg(){if(this.selectIndex<0){d({message:"请选择要下载的图片"});return}w({message:"正在下载图片",forbidClick:!0,loadingType:"spinner",duration:0});let e=this,t=Math.random().toString(36).slice(-8);k({url:"/updateDownImage",method:"post",data:{orderId:e.orderId,downloadedImage:e.selectIndex+1}}).then(s=>{u(),s.data.code==200?(O(e.selectImgPath,t),d({title:"下载成功",message:"图片已保存到相册"}).then(()=>{e.onClickLeft()})):d({title:"下载失败",message:"图片下载失败,请稍后再试"}).then(()=>{})}).catch(s=>{console.log(s),u()})}},mounted(){let t=x().order;this.images=t.generated_image,this.orderId=t.order_id}};async function O(e,t){if(!e)return;console.log(e);let s=await y({method:"get",url:e,responseType:"blob"}),c=window.URL.createObjectURL(s.data),o=document.createElement("a");o.href=c,o.download=t,o.click(),o.remove(),window.URL.revokeObjectURL(c)}const R=e=>(S("data-v-bcf5ad5e"),e=e(),T(),e),j={class:"content"},N={class:"imgs"},U=R(()=>a("div",{class:"tipTxt"},[a("span",{class:"txt"},"请选择一张你满意的图片保存到相册")],-1)),V={class:"dload"};function z(e,t,s,c,o,n){const p=l("van-nav-bar"),f=l("van-image"),_=l("van-button");return r(),g("div",null,[a("div",null,[h(p,{title:"下载图片",fixed:!0,"safe-area-inset-top":!0,placeholder:!0,"left-text":"","left-arrow":"",onClickLeft:n.onClickLeft},null,8,["onClickLeft"])]),a("div",j,[a("div",N,[(r(!0),g(b,null,F(o.images,(I,i)=>(r(),L(f,{class:B(n.checkStyle(i)),src:o.host+I,fit:"cover",onClick:A=>n.onImgTap(i)},null,8,["class","src","onClick"]))),256))]),U,a("div",V,[h(_,{class:"dlBtn",onClick:n.onDloadImg,type:"primary"},{default:D(()=>[E("保存图片")]),_:1},8,["onClick"])])])])}const Z=C(P,[["render",z],["__scopeId","data-v-bcf5ad5e"]]);export{Z as default};
