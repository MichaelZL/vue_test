import{m as I,n as l,f as h,A as y,h as S,_ as w,g as m,o as r,c as F,i as c,a as n,t as p,q as f,u as v,w as C,v as T,x as b,p as A,k as D,y as L}from"./index-c33601ed.js";import{c as E,s as k}from"./conversion-aeb0719e.js";var q=E;const B={data(e){return{isImgSelect:!1,tmpSelImg:"",selImgData:Blob,aiImg:"https://dummyimage.com/500x400/bababa/bababa",originImg:"",mode_name:"",description:"",points_required:5,template_index:"",mode:{originImg:"",aiImg:"",description:"",name:"",points_required:5,nameImg:"",template_index:""}}},methods:{onClickLeft(){this.$router.back()},onSelectImg(){this.$refs.openAlbum.click()},onGetImg(e){let t=this,a=e.target.files[0];I({message:"加载中...",forbidClick:!0,loadingType:"spinner"}),U(a).then(o=>{var s=new FileReader;s.readAsDataURL(o),s.onload=function(g){t.isImgSelect=!0,t.tmpSelImg=s.result,t.selImgData=o,l()}})},onUploadImg(){let e=this,a=h().openId;I({message:"正在上传...",forbidClick:!0,loadingType:"spinner",duration:0}),y({url:"/upLoadImage",method:"post",headers:{"Content-Type":"multipart/form-data"},data:{file:e.selImgData,template_name:e.template_index,open_id:a}}).then(i=>{l();let o=i.data;o.code==200?k({title:"上传成功",message:"图片正在生成中，请到'我的'页面中查看"}).then(()=>{e.onClickLeft()}):o.code==202&&k({title:"积分不足",message:"您的积分不足，请稍后再试"}).then(()=>{})}).catch(i=>{console.log(i),l()})}},created(){console.log("created");let t=h().mode;this.aiImg=S+t.aiImg,this.originImg=t.originImg,this.description=t.description.replace(/\\n/gm,`
`),this.mode_name=t.name,this.points_required=t.points_required,this.template_index=t.template_index},mounted(){},components:{}};function U(e){return e.type==="image/jpeg"||e.type,e.size<=1024*1024?new Promise(t=>{t(e)}):new Promise(t=>{q.compressAccurately(e,1e3).then(a=>{let i=new File([a],"tmp.jpeg",{type:"image/jpeg, image/png"});console.log("cmpImg:"+i.size),t(a)})})}const d=e=>(A("data-v-c5f998f0"),e=e(),D(),e),j={class:"nameTxt"},N=d(()=>n("div",{class:"cutline"},null,-1)),V={class:"preTxt"},P={class:"preTxt"},z=d(()=>n("div",{class:"cutline"},null,-1)),G={class:"optarea"},R=d(()=>n("div",{class:"boundline"},null,-1));function M(e,t,a,i,o,s){const g=m("van-nav-bar"),u=m("van-image"),_=m("van-button");return r(),F("div",null,[c(g,{title:"上传图片","left-text":"","left-arrow":"",onClickLeft:s.onClickLeft,fixed:!0,placeholder:!0},null,8,["onClickLeft"]),n("div",null,[c(u,{class:"preImg",src:o.aiImg,fit:"cover"},null,8,["src"])]),n("span",j,p(o.mode_name),1),N,n("span",V,p(o.description+`
`),1),n("span",P,p("消耗积分："+o.points_required),1),z,n("div",null,[o.isImgSelect?(r(),f(u,{key:0,class:"preSelImg",src:o.tmpSelImg,fit:"cover"},null,8,["src"])):v("",!0)]),n("div",G,[c(_,{class:"btn",plain:"",type:"primary",onClick:s.onSelectImg},{default:C(()=>[b("选择图片")]),_:1},8,["onClick"]),o.isImgSelect?(r(),f(_,{key:0,class:"btn",type:"primary",onClick:s.onUploadImg},{default:C(()=>[b("开始生成")]),_:1},8,["onClick"])):v("",!0)]),n("div",null,[T(n("input",{type:"file",ref:"openAlbum",name:"oriImg",id:"oriImg",accept:"image/png, image/jpeg",onChange:t[0]||(t[0]=x=>s.onGetImg(x))},null,544),[[L,!1]])]),R])}const K=w(B,[["render",M],["__scopeId","data-v-c5f998f0"]]);export{K as default};
