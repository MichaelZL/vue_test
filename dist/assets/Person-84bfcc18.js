import{b as h,f,A as x,s as g,h as p,l as V,_ as C,g as d,o as _,c as u,i as n,a as i,t as v,w as I,F as y,j as P}from"./index-c33601ed.js";const S={data(){const t=h(!0);return{avatar:"https://dummyimage.com/120x120/c2c2c2/fff.png",total_points:20,refreshing:h(!1),noDataTxt:"无任何图片记录,下拉刷新！",loading:h(!1),finished:t,orders:[{order_id:"",user_id:"",image_id:"",template_name:"",creation_time:"",deducted_points:5,generated_image:[""],downloaded_image:0,status:-1,trace_id:""}]}},methods:{onRefresh(){let t=f(),e=this;this.finished=!1,this.loading=!0,this.refreshing=!0;let o=t.openId;x({url:"/ordersList",method:"post",data:{open_id:o}}).then(a=>{let r=a.data.data;e.total_points=r.total_points,e.orders=r.Datalsit,e.onload()}).catch(a=>{console.log(a),e.onload()})},onload(){this.loading=!1,this.finished=!0,this.refreshing=!1},onCheckOrder(t){if(this.refreshing)g("正在加载中...");else{let e=this.orders[t];switch(this.checkItemStatus(t)){case 0:g("正在生成中...");break;case 1:let o=f();o.order=e,this.$router.push("/dloadImg");break;case 2:let a=p+e.generated_image[e.downloaded_image-1];V({images:[a],closeable:!0,showIndex:!1,minZoom:1,closeIcon:"cross",closeIconPosition:"top-left",closeOnClickOverlay:!1});break}}},checkItemImg(t){let e=this.orders[t];var o="";return this.checkItemStatus(t)==2?o=e.generated_image[e.downloaded_image-1]:o=e.image_id,p+o},checkItemTitle(t){switch(this.checkItemStatus(t)){case 0:return"生成中";case 1:return"生成成功";case 2:return"已完成"}},checkItemStatus(t){let e=this.orders[t];return e.status==2&&e.downloaded_image!=null?2:e.status==2&&e.downloaded_image==null?1:0}},mounted(){},activated(){console.log("activated"),this.orders.length>0&&(this.noDataTxt="已全部显示");const t=window.innerHeight-270;document.getElementById("orderView").style.height=t+"px",this.onRefresh()}};const T={class:"bg"},D={class:"info"},F={class:"userCredits"},R={class:"orderList"},B=["onClick"],O={class:"img_box"},A={class:"orderInfo"};function E(t,e,o,a,s,r){const k=d("van-nav-bar"),m=d("van-image"),w=d("van-list"),b=d("van-pull-refresh");return _(),u("div",T,[n(k,{title:"我的",fixed:!0,"safe-area-inset-top":!0,placeholder:!0}),i("div",D,[n(m,{class:"userImg",round:"",src:s.avatar,fit:"cover"},null,8,["src"]),i("text",F,"积分："+v(s.total_points),1)]),i("div",R,[n(b,{class:"orderbg",ref:"pull",id:"orderView",disabled:!1,modelValue:s.refreshing,"onUpdate:modelValue":e[1]||(e[1]=l=>s.refreshing=l),onRefresh:r.onRefresh},{default:I(()=>[n(w,{class:"scroll",modelValue:s.loading,"onUpdate:modelValue":e[0]||(e[0]=l=>s.loading=l),finished:s.finished,"finished-text":s.noDataTxt,ref:"list"},{default:I(()=>[(_(!0),u(y,null,P(s.orders,(l,c)=>(_(),u("div",{class:"listitem",onClick:L=>r.onCheckOrder(c)},[i("div",O,[n(m,{class:"img",src:r.checkItemImg(c),fit:"cover"},null,8,["src"])]),i("span",A,v(r.checkItemTitle(c)),1)],8,B))),256))]),_:1},8,["modelValue","finished","finished-text"])]),_:1},8,["modelValue","onRefresh"])])])}const N=C(S,[["render",E],["__scopeId","data-v-9a1d017b"]]);export{N as default};
